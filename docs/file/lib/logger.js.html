<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">lib/logger.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/ShogunPanda/apes" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/application.js~Application.html">Application</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/http-server.js~HTTPServer.html">HTTPServer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/logger.js~Logger.html">Logger</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/runtime-error.js~RuntimeError.html">RuntimeError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/utils.js~Utils.html">Utils</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">lib/logger.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/*
 * This file is part of the apes.js npm package. Copyright (C) 2016 and above Shogun &lt;shogun@cowtech.it&gt;.
 * Licensed under the MIT license, which can be found at http://www.opensource.org/licenses/mit-license.php.
 */

const path = require(&quot;path&quot;);
const winston = require(&quot;winston&quot;);
const fs = require(&quot;fs-extra&quot;);
const Bluebird = require(&quot;bluebird&quot;);

let Application = null;
const mkdirsAsync = Bluebird.promisify(fs.mkdirs);

/**
 * A class to perform rich logging, based on [Winston](http://npmjs.com/package/winston).
 *
 * @class Logger
 */
class Logger{
  /**
   * Creates a new logger.
   *
   * @param {string} target The target log file. It will be stored in the `log` folder with the current environment appended.
   * @param {boolean} [useConsole=false] Whether or not also log on console.
   * @param {any} [root=null] The root folder for the log file. Usually it&apos;s the `log` in the current working directory.
   *
   * @memberOf Logger
   */
  constructor(target, useConsole = false, root = null){
    // This is to resolve a cyclic dependency
    if(!Application)
      Application = require(&quot;./application&quot;); // eslint-disable-line global-require

    this.root = path.resolve(root || Application.root, &quot;log&quot;);
    this.target = target;
    this.useConsole = useConsole;
  }

  /**
   * Prepares the logger for use.
   *
   * @returns {Promise&lt;winston.Logger&gt;|Error} The current logger in case of success, the error otherwise.
   */
  async prepare(){
    if(this.backend)
      return Promise.resolve(this);

    await mkdirsAsync(this.root);

    const target = path.resolve(this.root, `${this.target}.log`);

    // Create transports
    const level = Application.debug ? &quot;debug&quot; : &quot;verbose&quot;;
    const transports = [
      new winston.transports.File({name: &quot;file&quot;, filename: target, level, stderrLevels: [&quot;error&quot;], colorize: true, timestamp: true})
    ];

    if(this.useConsole)
      transports.unshift(new winston.transports.Console({name: &quot;console&quot;, level, stderrLevels: [&quot;error&quot;], colorize: true, timestamp: true}));

    // Create the logger
    this.backend = new winston.Logger({transports});
    Bluebird.promisifyAll(this.backend);
    return this;
  }

  /**
   * Logs a message with info priority level `info`.
   *
   * @param {any[]} args The message to log.
   * @returns {Promise&lt;winston.Logger&gt;|Error} The backend in case of success, the error otherwise.
   */
  info(...args){
    return this.backend.infoAsync(...args);
  }

  /**
   * Logs a message with info priority level `warn`.
   *
   * @param {any[]} args The message to log.
   * @returns {Promise&lt;winston.Logger&gt;|Error} The backend in case of success, the error otherwise.
   */

  warn(...args){
    return this.backend.warnAsync(...args);
  }

  /**
   * Logs a message with info priority level `error`.
   *
   * @param {any[]} args The message to log.
   * @returns {Promise&lt;winston.Logger&gt;|Error} The backend in case of success, the error otherwise.
   */

  error(...args){
    return this.backend.errorAsync(...args);
  }

  /**
   * Logs a message with info priority level `fatal` and then quits the process.
   *
   * @param {any[]} args The message to log.
   * @returns {Promise&lt;winston.Logger&gt;|Error} The backend in case of success, the error otherwise.
   */

  fatal(...args){
    return this.backend.errorAsync(...args).then(() =&gt; process.exit(1)); // eslint-disable-line no-process-exit
  }

  /**
   * Logs a message with info priority level `debug`.
   *
   * @param {any[]} args The message to log.
   * @returns {Promise&lt;winston.Logger&gt;|Error} The backend in case of success, the error otherwise.
   */
  debug(...args){
    if(!Application.debug)
      return Promise.resolve(this.backend);

    return this.backend.debugAsync(...args);
  }
}

module.exports = Logger;
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.8)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
